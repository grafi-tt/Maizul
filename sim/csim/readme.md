# C Simulatorについて

## 付記
現状では最新のISAに対応していない．また，サンプルファイルも同様に古いISAである．といっても，レジスタの位置と一部の命令コードが入れ替わっただけで，本質的な変更点は無い．そのうち対応する．

## 製作目的
*   高速に一応の動作をするシミュレータを確保するため
*   コアの命令デコード部にかなり近いやり方で命令デコードすることで，命令フォーマット設計についてのある種のドキュメントとするため
*   OCamlのシミュレータの出力と突き合わせて，シミュレータの正しさのクロスチェックをするため
*   単にVHDLに飽きたから

## ビルド方法
現在1ファイルに雑に書いてしまっているし，Makefileもない．また，コンパイル時，あるいは実行時に指定できるようにするべきフラグがソースコードに書き込まれてしまっている．

    gcc -O3 -Wall -std=c99 -lm csim.c -o csim

でビルドは可能．適当にファイルを分けて見やすくしたうえで，Makefileを作りたい．むしろ誰かやってほしい．

なお，GCC拡張の2進数リテラルを使っているので，GCC 4.3以上くらいじゃないとコンパイルできない．

## サンプル
samplesディレクトリに，機械語入力を示したテキストと，テキストを実際のバイナリに変換するRubyスクリプトがある．

    ruby binary.rb < hoge.txt > hoge

で，hogeというファイルにシミュレータの引数として渡すことのできるバイナリが出力される．

## 実行方法
    csim hoge

ステップ実行フラグを有効にしてコンパイルした場合は，命令一つ一つがステップ実行される．（この挙動はあまりに適当で，現実的には使いものにならない．まともなブレークポイントの実装は，シミュレータ班が作るものでやってほしい）

    r<0-31>
    mem<自然数>

という形式の入力をしてエンターすると，そこに現在保存されている値が表示される．何も入力せずにエンターすると，次の命令を実行する．
